# FFMPEG Command Line

## 前言

FFMPEG是特别强大的专门用于处理音视频的开源库。你既可以使用它的AP刺音视频进行处理，也可以使周它提供的工具，如ffmpeg, ffplay, ffprobe ,来编辑你的音视频文件。

本文简要介绍一下FFMPEG库的基本目录结构及其功能，然后详细介绍一下我们在日常工作中，如何使用ffmpeg提供的工具来处理音视频文件。

## FFMPEG目录及作用

libavcodec :提供了一系列编码器的实现。 
libavformat:实现在流协议，容器掐式及其本10访问。 
libavutil : 包 括 了hash器，解码器和各利工具函数。 
libavfilter:提供了各种音视频过滤器。 
libavdevice :提供了访问捕获设备和回放设备的接口。 
libswresample :实现了混音和重采样。 
libswscale :实现了色彩转獅缩放工能。

## FFMPEG基本概念

在讲解FFMPEG命令之前，我们先要介绍一些音视频格式的基本概念。

### 音/视频流

在音视频领域 ，我们把一路音/视频为一路流 。如我们小时 常使用VCD看港片，在里边可以选择蜜语或囯语声音，其实就是CD视频文件中存放了两路音频流，用户可以选择其中一路进行播放。

### 容器

我们一般把MP4、FLV、MOV等文件格式称之为容器。也就是在这些常用格式文件中，可以存放多路音视频文件。以MP4为例，就可以存放一路视频流，多路音频流，多路字幕。

### channel

Channel是音频中的概念，称之为声道。在一路音频流中，可以有单声道，双声道或立体声。

### FFMPEG命令

我们按使用目的可以将FFMPEG命令分成以下几类：

基本信息查询命令

录制

分解/复用

处理原始数据

滤镜

切割与合并

图/视互转

直播

除了ffmpeg的基本信息查询命令外，其它命令都按下图所示的流程处理音视频。

![截屏2020-07-16 下午4.06.28](/Users/wenshasha/Library/Application Support/typora-user-images/截屏2020-07-16 下午4.06.28.png)

然后将编码的数据包传送给解码器（除非为数据流选择了流拷贝，请参阅进一步描述）。解码器产生未压缩的帧（原始视频/ PCM音频，可以通过滤波进一步处理。

在过滤之后，帧被传递到编码器，编码器并输出编码的包。最后，这些传递给复用器，将编码的数据包写入输出文件。
默认情况下，ffmpeg只包含输入文件中每种类型（视频，音频，字幕）的一个流，并将其添加到每个输出文件中。它根据以下标准挑选每一个的"最佳" :对于视频，它是具 
有最高分辦率的流，对于音频，它是具有最多channel的流，对于宇幕，是第一个幕流。在相同类型的几个流相等的情况下，选择具有最低索引的流。

可以通过使用-vn / -an / -sn / -dn选理来禁用某些默认设置。要进行全面的手动控制，请使用-map选项，该选项禁用刚描述的默认设置。

### 基本信息查询命令

FFMPEG可以使用下面的参数进行基本信息查询。例如，想查询一TiaS使用的FFMPEG都支持哪些filter,就可以用ffmpeg -filters来查询。讳细参数说明如下：
-version显示版本。
-formats显示可用的格式（包活设备）。
-demuxers 显示可用的 demuxers0 
-muxers显示可用的muxers0 
-devices显示可用的设备。
-codecs显示libavcodec已知的所有编解码器。
-decoders显示可用的解码器。
-encoders显示所有可用的编码器。
-bsfs显示可用的比特流filter。
-protocols显示可用的协议。
-filters显示可用的libavfilter过滤器。
-pix_fmts显示可用的像素掐式。
-sample_fmts显示可用的采样格式。
-layouts显示channel名称和标准channel布局。
-colors显品朗ij的颜色名称。

### 命令基本格式及参数

ffmpeg [global_options] {[input_file_options] -i  input_url}...

{[output_file_options] output_url}...

ffmpeg通过-i选项读取输任意数量的输入"文件"（可以是常规文件，管道，网络流，抓取设备等，并写入任意数量的输出"文件"。
原则上，每个输入/输出"文件"都可以包含任意数量的不同类型的视频流（视频/音频/字幕/附件/数据）。流的数量和类型是由容器格式来限制。选择从哪个输入进入到哪个输出将自动完成或使用 -map选项。

要引用选项中的输入文件，您必须使用它们的索引（从0开始）。例如。第一个输入文件是0,第二个输入文件是1,等等。类似地，文件内的流被它们的索弓I引用。例如。2: 
3是指第三个输入文件中的第四个流。

### 主要参数

-f fmt (输入激出）强制输入或输出文件格式。格式通常是自动检测输入文件，并从输出文件的文件扩展名中猜测出来，所以在大多数情况下这个选项是不需要的。

-i url (输入）输入文件的网址

-y (全局参数）覆盖输出文件而不询问。

-n (全局参数）不要覆盖输出文件，如果指定的输出文件已经存在，请立即退出。

-c [: stream_specifier] codec (输入M出，每个流）选择码器（当在输出文件之前使用）或解码器（当在输入文件之前使苗时）庙于—t或多个流。codec是解码器/ 
编码器的名称_或 copy (仅输出）以指面亥)重_码。如： ffmpeg -i INPUT -map 0 -c:v Iibx264 -c:a copy OUTPUT

-codec [: stream_specifier]编解码器（输入出，每个流）同-c

-t duration (输入^出）当用作输入选项（在-i之前）时，限制从输入文件读取的翻的持续时间。当用作输出选项时（在输出url之前寺续时间到达持续时间之后停止输出。

-ss位置（输入激出）当用作输入选项时（在-i之 前 ） ， 在 这 个 输 入 文 件 中 寻 找 位 置 。 请 注 意 ， 在 大 多 数 格 式 中 ， 不 可 能 精 确 搜 索 ， 因 此 位 置 之 前 寻 找 最 近 的 搜 索 、点。当转码和-accurate_seek|g启用时（默认），搜索点和位置之间的这个额外的分段将被解码和丟弃。当进行流式复制或使用-noaccurate_seek时，它将被保留。当用作输 
出选顼（在输出url之前）时，解码但丟弃输入，直到时间戳到达位置。

-frames [: stream_specifier] framecount (output, per-stream )停止在♦ 贞计数♦ 贞之后写入流。

-filter [: stream_specifier] filtergraph (output, per-stream ) 创建由filtergraph指定的过滤器图，并使用它来过滤流。filtergraph是应用于流的filtergraph的描须具有相同类型的流的单*t输入和单*t输出。在过滤器图形中，输入与标签中的标签相关联，标签中的输出与标签相关联。有关filtergraph语法的更多信息，请参阅ffmpeg- 
filters 羊册。